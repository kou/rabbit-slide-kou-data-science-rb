= Rubyã‚‚Apache Arrowã§\nãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨€èªã®\nä»²é–“å…¥ã‚Š

: author
   é ˆè—¤åŠŸå¹³
: institution
   ã‚¯ãƒªã‚¢ã‚³ãƒ¼ãƒ‰
: content-source
   DataScience.rbãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—
: date
   2017-05-19
: allotted-time
   20m
: theme
   clear-code

= ã¯ã˜ã‚ã«

(('tag:center'))
(('tag:large'))
ç§ã¯RubyãŒå¥½ãã 

(('tag:center'))
(('tag:large'))
ã ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿åˆ†æã ã£ã¦\n
Rubyã§ã‚„ã‚ŠãŸã„

(('tag:center'))
(('note:Rubyã‚ˆã‚Šã‚‚å‘ã„ã¦ã„ã‚‹è¨€èªãŒã‚ã‚‹ã®ã¯ã‚ã‹ã£ã¦ã„ã‚‹ã‘ã©ã•ãƒ¼'))

= Apache Arrow

  * ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜

(('tag:center'))
ã¨

  * ãã®ä»•æ§˜ã‚’å‡¦ç†ã™ã‚‹å®Ÿè£…

= Arrowï¼šè§£æ±ºã—ãŸã„å•é¡Œ

  * é«˜ã„ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆ
    * â†’ä½ãã—ãŸã„
  * é‡è¤‡ã—ãŸæœ€é©åŒ–å®Ÿè£…
    * â†’å®Ÿè£…ã‚’å…±æœ‰ã—ãŸã„

= Arrowï¼šæ–‡è„ˆ

ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

= ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

  * ã„ã‚ã‚“ãªã‚·ã‚¹ãƒ†ãƒ ãŒé€£æº
    * Javaå®Ÿè£…ã®ã‚‚ã‚ã‚‚ã‚ã¨Pythonã¨R
  * ã‚·ã‚¹ãƒ†ãƒ é–“ã§ãƒ‡ãƒ¼ã‚¿äº¤æ›ãŒå¿…è¦
    * äº¤æ›ã™ã‚‹åº¦ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»ãƒ‘ãƒ¼ã‚¹
    * (('wait'))â†‘ã«çµæ§‹CPUã¨æ™‚é–“ã‚’ä½¿ã‚ã‚Œã‚‹â€¦
    * (('wait'))ãã‚“ãªã®ã‚ˆã‚Šåˆ†æå‡¦ç†ã«ä½¿ã„ãŸã„ï¼

= Arrowï¼šè§£æ±ºæ–¹é‡

ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã®\n
ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»\n
ãƒ‘ãƒ¼ã‚¹

= Arrowï¼šã‚³ã‚¹ãƒˆã‚¼ãƒ­ã®å®Ÿç¾

  * ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    * ä¾‹:int8ã®é…åˆ—â†’int8ã®å€¤ã‚’é€£ç¶šé…ç½®
    * 1ãƒã‚¤ãƒˆãšã¤ãšã‚‰ã›ã°é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹å¯
  * Arrowã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
    * ã‚µã‚¤ã‚ºåœ§ç¸®ã‚ˆã‚Šã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚¼ãƒ­
    * å‚è€ƒï¼šParquetã¯ã‚µã‚¤ã‚ºåœ§ç¸®å„ªå…ˆ

= ArrowãŒã‚ã‚‹ä¸–ç•Œ

  * å„ã‚·ã‚¹ãƒ†ãƒ ãŒã‚µã‚¯ã‚µã‚¯é€£æº
    * ä¾‹ï¼šPySparkãŒé«˜é€ŸåŒ–
    * ç†ç”±:PyğŸ¡˜Javaã®ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆæ¸›
  * Javaãƒ»Pythonãƒ»Rä»¥å¤–ã‚‚æ´»èº
    * ä¾‹ï¼šRubyãƒ»Goãƒ»Rustãƒ»Juliaã¨ã‹
    * ç†ç”±ï¼šä½ã‚³ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿äº¤æ›å¯èƒ½

= Arrowã¨Ruby

ãƒãƒ£ãƒ³ã‚¹ï¼

= Arrowã¨Rubyã¨ãƒ‡ãƒ¼ã‚¿åˆ†æ

  * RubyãŒArrowã«å¯¾å¿œ
    * Rubyã«ãƒ‡ãƒ¼ã‚¿ãŒå›ã£ã¦ãã‚‹ï¼
    * â†’Rubyã«ã‚‚ãƒ‡ãƒ¼ã‚¿åˆ†æã®æ©Ÿä¼šãŒï¼\n
      (('note:ï¼ˆä»Šã¯ã§ãã‚‹ã“ã¨ã¯å°‘ãªã„ã ã‚ã†ã‘ã©â€¦ï¼‰'))
  * (('wait'))æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
    * ã§ãã‚‹ã“ã¨ã‚’å¢—ã‚„ã—ã¦ã„ãï¼
    * â†’Rubyã§ã‚‚ã„ã‚ã„ã‚ãƒ‡ãƒ¼ã‚¿åˆ†æï¼

= Arrowã¨Rubyã®ä»Š

  * Rubyã§Arrowã‚’ä½¿ãˆã‚‹ï¼
    * ç§ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã‹ã‚‰ï¼\n
      (('note:ã‚³ãƒŸãƒƒã‚¿ãƒ¼ã«ã‚‚ãªã£ãŸ'))
    * å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã«ã‚‚å…¥ã£ã¦ã„ã‚‹\n
      (('note:å³å¯†ã«è¨€ã†ã¨é•ã†ã‚“ã ã‘ã©å…¬å¼ã‚µãƒãƒ¼ãƒˆã ã¨æ€ã£ã¦ã‚ˆã„'))
  * Rubyã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿æ›¸ãã§ãã‚‹

= ä»Šã§ãã‚‹ã“ã¨

  * Pythonãƒ»Rã¨ã®ãƒ‡ãƒ¼ã‚¿äº¤æ›
  * Rubyã®å„ç¨®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼é–“ã§ã®\n
    ãƒ‡ãƒ¼ã‚¿äº¤æ›

= Arrowï¼šPython

  # coderay python
  # pandasã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’Arrowã§æ›¸ãè¾¼ã¿
  import pyarrow as pa

  df = pd.DataFrame({"a": [1, 2, 3],
                     "b": ["hello", "world", "!"]})
  record_batch = pa.RecordBatch.from_pandas(df)

  with pa.OSFile("/tmp/pandas.arrow", "wb") as sink:
      schema = record_batch.schema
      writer = pa.RecordBatchFileWriter(sink, schema)
      writer.write_batch(record_batch)
      writer.close()

= Arrowï¼šRuby

  # coderay ruby
  # Rubyã§pandasã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
  require "arrow"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/pandas.arrow") do |input|
    reader = Arrow::RecordBatchFileReader.new(input)
    reader.each do |record_batch|
      puts("=" * 40)
      puts(record_batch)
    end
  end

= Featherï¼šR

  # coderay R
  # Rã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’Featherã§æ›¸ãè¾¼ã¿
  library("feather")

  df = data.frame(a=c(1, 2, 3),
                  b=c(1.1, 2.2, 3.3))
  write_feather(df, "/tmp/dataframe.feather")

= Featherï¼šRuby

  # coderay ruby
  # Rubyã§Rã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
  require "arrow"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/dataframe.feather") do |input|
    reader = Arrow::FeatherFileReader.new(input)
    reader.columns.each do |column|
      puts("#{column.name}: #{column.to_a.inspect}")
    end
  end

= Parquetï¼šPython

  # coderay python
  # Pythonã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’Parquetã§æ›¸ãè¾¼ã¿
  import pandas as pd
  import pyarrow as pa
  import pyarrow.parquet as pq

  df = pd.DataFrame({"a": [1, 2, 3],
                     "b": ["hello", "world", "!"]})
  table = pa.Table.from_pandas(df)
  pq.write_table(table, "/tmp/pandas.parquet")

= Parquetï¼šRuby

  # coderay ruby
  # Rubyã§Parquetå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
  require "arrow"
  require "parquet"

  path = "/tmp/pandas.parquet"
  reader = Parquet::ArrowFileReader.new(path)
  table = reader.read_table
  table.each_column do |column|
    puts("#{column.name}: #{column.to_a.inspect}")
  end

= å¯¾å¿œãƒ‡ãƒ¼ã‚¿å½¢å¼ã¾ã¨ã‚

  * Arrowå½¢å¼
    * å„ç¨®è¨€èª(('note:ï¼ˆã“ã‚Œã‹ã‚‰åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ã¯ãšï¼‰'))
  * Featherå½¢å¼
    * Pythonãƒ»Rå°‚ç”¨
  * Parquetå½¢å¼
    * å„ç¨®è¨€èª(('note:ï¼ˆHadoopç•Œéšˆã§ã™ã§ã«åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ï¼‰'))

= å¤šæ¬¡å…ƒé…åˆ—

  * Arrowã§ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
    * ãƒ†ãƒ³ã‚½ãƒ«ã¨å‘¼ã‚“ã§ã„ã‚‹\n
      (('note:ï¼ˆtraditional multidimensional array objectã¨èª¬æ˜ï¼‰'))
  * C++å®Ÿè£…ã§ã¯ã‚µãƒãƒ¼ãƒˆ
    * ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã¯ä½¿ãˆã‚‹
    * Pythonãƒ»Rubyâ€¦ã§ã¯ä½¿ãˆã‚‹

= Tensorï¼šPython

  # coderay python
  # NumPyã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’æ›¸ãè¾¼ã¿
  import pyarrow as pa
  import numpy as np

  ndarray = np.random.randn(10, 6) # 10x6
  print(ndarray)
  tensor = pa.Tensor.from_numpy(ndarray)
  with pa.OSFile("/tmp/tensor.arrow", "wb") as sink:
      pa.write_tensor(tensor, sink)

= Tensorï¼šRuby

  # coderay ruby
  # Rubyã§èª­ã¿è¾¼ã¿
  require "arrow"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    p tensor.shape # => [10, 6]
  end

= Rubyï¼šGSL

  # coderay ruby
  # GSLã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
  require "arrow"
  require "arrow-gsl"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_gsl
    # tensor.to_gsl.to_arrow == tensor
  end

= Rubyï¼šNMatrix

  # coderay ruby
  # NMatrixã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
  require "arrow"
  require "arrow-nmatrix"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_nmatrix
    # tensor.to_nmatrix.to_arrow == tensor
  end

= Rubyï¼šNumo::NArray

  # coderay ruby
  # Numo::NArrayã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
  require "arrow"
  require "arrow-numo-narray"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_narray
    # tensor.to_narray.to_arrow == tensor
  end

= ã“ã“ã¾ã§ã®ã¾ã¨ã‚1

  * ArrowãŒå®Ÿç¾ã—ãŸã„ä¸–ç•Œ
    * ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆãŒä½ã„ä¸–ç•Œ
    * æœ€é©åŒ–å®Ÿè£…ã‚’å…±æœ‰ã—ã¦ã„ã‚‹ä¸–ç•Œ

= ã“ã“ã¾ã§ã®ã¾ã¨ã‚2

  * Rubyã¨Arrowã®ä»Š
    * Arrowã¯Rubyã‚’å…¬å¼ã‚µãƒãƒ¼ãƒˆï¼
    * Rubyã®å¤–ã®ä¸–ç•Œã¨ãƒ‡ãƒ¼ã‚¿äº¤æ›å¯èƒ½\n
      (('note:ï¼ˆArrowãƒ»Featherãƒ»Parquetã‚’ã‚µãƒãƒ¼ãƒˆï¼‰'))
    * Rubyã®å„ç¨®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¨ã®\n
      ç›¸äº’å¤‰æ›ãŒå¯èƒ½\n
      (('note:ï¼ˆãƒ¡ãƒ¢ãƒªãƒ¼ã‚³ãƒ”ãƒ¼ãã‚‰ã„ã®ã‚³ã‚¹ãƒˆã§ï¼‰'))

= Arrowã¨Rubyã¨ã“ã‚Œã‹ã‚‰

  * Arrow
    * ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†ã®æœ€é©åŒ–å®Ÿè£…
    * ãƒãƒ«ãƒã‚³ã‚¢å¯¾å¿œ
    * GPUå¯¾å¿œ
  * Ruby
    * Red Data Toolsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

= Red Data Tools

  * Rubyã§ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã—ãŸã„ãªãï¼\n
    å®Ÿç¾ã‚’ç›®æŒ‡ã™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  * URLï¼š
    * https://github.io/red-data-tools
    * https://red-data-tools.github.io
    * https://gitter.im/red-data-tools

= æ—¢å­˜ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ

  * Red Arrow(('note:ï¼ˆArrowã®Rubyãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰'))
    * Red Arrow XXX(('note:ï¼ˆArrowã¨XXXã®ç›¸äº’å¤‰æ›ï¼‰'))
  * Parquet GLib(('note:ï¼ˆParquetã®GLibãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰'))
  * Red Parquet(('note:ï¼ˆParquetã®Rubyãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰'))
  * Jekyll Jupyter Notebook plugin(('note:ï¼ˆJekyllã§Jupyter Notebookã‚’è¡¨ç¤ºï¼‰'))

= ãƒãƒªã‚·ãƒ¼

  * Acting than blaming\n
    (('note:æ™‚é–“ã¯å˜†ããƒ»éé›£ã‚ˆã‚Šæ‰‹ã‚’å‹•ã‹ã™ã“ã¨ã«ä½¿ã†'))
  * Continuous small works than a temporary big work than\n
    (('note:ä¸€æ™‚çš„ãªé›†ä¸­ã˜ã‚ƒãªãå°ã•ãã¦ã‚‚ç¶™ç¶šã—ã¦æ´»å‹•ã™ã‚‹'))
  * Ignore blames from outsiders\n
    (('note:éƒ¨å¤–è€…ã®éé›£ã¯æ°—ã«ã—ãªã„'))\n
    (('note:çµæœãŒã§ã‚‹ã¾ã§ã‚°ãƒã‚°ãƒè¨€ã‚ã‚Œã‚‹ã¯ãš :p'))
  * Fun! (Because we use Ruby!)

= Join Us!

  * Rubyã§ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã—ãŸã„äººï¼
  * ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã§ãã‚‹äººï¼\n
    (('note:ï¼ˆæ‰‹ã‚’å‹•ã‹ã™äººï¼ç¶™ç¶šã™ã‚‹äººï¼æ¥½ã—ã‚“ã§ã‚„ã‚‹äººï¼ï¼‰'))
  * URLï¼š
    * https://github.io/red-data-tools
    * https://red-data-tools.github.io
    * https://gitter.im/red-data-tools
