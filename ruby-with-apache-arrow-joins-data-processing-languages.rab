= Rubyã‚‚Apache Arrowã§\nãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨€èªã®\nä»²é–“å…¥ã‚Š

: author
   é ˆè—¤åŠŸå¹³
: institution
   ã‚¯ãƒªã‚¢ã‚³ãƒ¼ãƒ‰
: content-source
   DataScience.rbãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—
: date
   2017-05-19
: allotted-time
   20m
: theme
   clear-code

= ã¯ã˜ã‚ã«

(('tag:center'))
(('tag:large'))
ç§ã¯RubyãŒå¥½ãã 

(('tag:center'))
(('tag:large'))
ã ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿åˆ†æã ã£ã¦\n
Rubyã§ã‚„ã‚ŠãŸã„

(('tag:center'))
(('note:Rubyã‚ˆã‚Šã‚‚å‘ã„ã¦ã„ã‚‹è¨€èªãŒã‚ã‚‹ã®ã¯ã‚ã‹ã£ã¦ã„ã‚‹ã‘ã©ã•ãƒ¼'))

= Apache Arrow

  * ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜
  * â†‘ã‚’æ‰±ã†å®Ÿè£…

= Arrowï¼šè§£æ±ºã—ãŸã„å•é¡Œ

  * é«˜ã„ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆ
  * é‡è¤‡ã—ãŸæœ€é©åŒ–å®Ÿè£…

= Arrowï¼šæ–‡è„ˆ

ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

= ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

  * ã„ã‚ã‚“ãªã‚·ã‚¹ãƒ†ãƒ ãŒé€£æº
    * Javaå®Ÿè£…ã®ã‚‚ã‚ã‚‚ã‚ã¨Pythonã¨R
  * ã‚·ã‚¹ãƒ†ãƒ é–“ã§ãƒ‡ãƒ¼ã‚¿äº¤æ›ãŒå¿…è¦
    * äº¤æ›ã™ã‚‹åº¦ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»ãƒ‘ãƒ¼ã‚¹
    * (('wait'))â†‘ã«çµæ§‹CPUã¨æ™‚é–“ã‚’ä½¿ã‚ã‚Œã‚‹â€¦
    * (('wait'))ãã‚“ãªã®ã‚ˆã‚Šåˆ†æå‡¦ç†ã«ä½¿ã„ãŸã„ï¼

= Arrowï¼šè§£æ±ºæ–¹é‡

ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã®\n
ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»\n
ãƒ‘ãƒ¼ã‚¹

= Arrowï¼šã‚³ã‚¹ãƒˆã‚¼ãƒ­ã®å®Ÿç¾

  * ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    * ä¾‹:int8ã®é…åˆ—â†’int8ã®å€¤ã‚’é€£ç¶šé…ç½®
    * 1ãƒã‚¤ãƒˆãšã¤ãšã‚‰ã›ã°é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹å¯
  * Arrowã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
    * ã‚µã‚¤ã‚ºåœ§ç¸®ã‚ˆã‚Šã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚¼ãƒ­
    * å‚è€ƒï¼šParquetã¯ã‚µã‚¤ã‚ºåœ§ç¸®å„ªå…ˆ

= ArrowãŒã‚ã‚‹ä¸–ç•Œ

  * å„ã‚·ã‚¹ãƒ†ãƒ ãŒã‚µã‚¯ã‚µã‚¯é€£æº
    * ä¾‹ï¼šPySparkãŒé«˜é€ŸåŒ–
    * ç†ç”±:PyğŸ¡˜Javaã®ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆæ¸›
  * Javaãƒ»Pythonãƒ»Rä»¥å¤–ã‚‚æ´»èº
    * ä¾‹ï¼šRubyãƒ»Goãƒ»Rustãƒ»Juliaã¨ã‹
    * ç†ç”±ï¼šä½ã‚³ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿äº¤æ›å¯èƒ½

= Arrowã¨Ruby

ãƒãƒ£ãƒ³ã‚¹ï¼

= Arrowã¨Rubyã¨ãƒ‡ãƒ¼ã‚¿åˆ†æ

  * RubyãŒArrowã«å¯¾å¿œ
    * Rubyã«ãƒ‡ãƒ¼ã‚¿ãŒå›ã£ã¦ãã‚‹ï¼
  * æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
    * ã§ãã‚‹ã“ã¨ã‚’å¢—ã‚„ã—ã¦ã„ã

= Arrowã¨Rubyã®ä»Š

  * Rubyã§Arrowã‚’ä½¿ãˆã‚‹ï¼
    * ç§ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã‹ã‚‰ï¼
    * å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã«ã‚‚å…¥ã£ã¦ã„ã‚‹\n
      (('note:å³å¯†ã«è¨€ã†ã¨é•ã†ã‚“ã ã‘ã©å…¬å¼ã‚µãƒãƒ¼ãƒˆã ã¨æ€ã£ã¦ã‚ˆã„'))
    * ã‚³ãƒŸãƒƒã‚¿ãƒ¼ã«ã‚‚ãªã£ãŸ

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
pandasã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’æ›¸ãè¾¼ã¿

  # coderay python
  import pyarrow as pa

  df = pd.DataFrame({"a": [1, 2, 3],
                     "b": ["hello", "world", "!"]})
  record_batch = pa.RecordBatch.from_pandas(df)

  with pa.OSFile("/tmp/pandas.arrow", "wb") as sink:
      schema = record_batch.schema
      writer = pa.RecordBatchFileWriter(sink, schema)
      writer.write_batch(record_batch)
      writer.close()

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
Rubyã§èª­ã¿è¾¼ã¿

  # coderay ruby
  require "arrow"

  Input = Arrow::MemoryMappedInputStream
  Reader = Arrow::RecordBatchFileReader
  Input.open("/tmp/pandas.arrow") do |input|
    reader = Reader.new(input)
    reader.each do |record_batch|
      puts("=" * 40)
      puts(record_batch)
    end
  end

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
NumPyã§ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆâ†’æ›¸ãè¾¼ã¿

  # coderay python
  import pyarrow as pa
  import numpy as np

  ndarray = np.random.randn(10, 6)
  print(ndarray)
  tensor = pa.Tensor.from_numpy(ndarray)
  with pa.OSFile("/tmp/tensor.arrow", "wb") as sink:
      pa.write_tensor(tensor, sink)

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
Rubyã§èª­ã¿è¾¼ã¿

  # coderay ruby
  require "arrow"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    p tensor.shape # => [10, 6]
  end

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
GSLã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›

  # coderay ruby
  require "arrow"
  require "arrow-gsl"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_gsl
    # tensor.to_gsl.to_arrow == tensor
  end

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
NMatrixã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›

  # coderay ruby
  require "arrow"
  require "arrow-nmatrix"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_nmatrix
    # tensor.to_nmatrix.to_arrow == tensor
  end

= ä»Šã§ãã‚‹ã“ã¨

(('tag:center'))
Numo::NArrayã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›

  # coderay ruby
  require "arrow"
  require "arrow-numo-narray"
  require "pp"

  Input = Arrow::MemoryMappedInputStream
  Input.open("/tmp/tensor.arrow") do |input|
    tensor = input.read_tensor(0)
    pp tensor.to_narray
    # tensor.to_narray.to_arrow == tensor
  end

= ã“ã“ã¾ã§ã®ã¾ã¨ã‚

  * ArrowãŒå®Ÿç¾ã—ãŸã„ä¸–ç•Œ
    * ãƒ‡ãƒ¼ã‚¿äº¤æ›ã‚³ã‚¹ãƒˆãŒä½ã„ä¸–ç•Œ
  * Rubyã¨Arrowã®ä»Š
    * Arrowã¯Rubyã‚’å…¬å¼ã‚µãƒãƒ¼ãƒˆï¼
    * Rubyã®å¤–ã®ä¸–ç•Œã¨ãƒ‡ãƒ¼ã‚¿äº¤æ›å¯èƒ½
    * Rubyã®å„ç¨®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¨ã®\n
      ç›¸äº’å¤‰æ›ãŒå¯èƒ½\n
      (('note:ï¼ˆãƒ¡ãƒ¢ãƒªãƒ¼ã‚³ãƒ”ãƒ¼ãã‚‰ã„ã®ã‚³ã‚¹ãƒˆã§ï¼‰'))

= Arrowã¨Rubyã¨ã“ã‚Œã‹ã‚‰

  * Arrow
    * ...
